<!DOCTYPE HTML>
<html>

<!--
    This page shows how to search for a location (by free text) and 
    retrieve the current conditions for the location.

    For more information visit: http://api.accuweather.com/developers/

    ** Remember that you need to obtain your own API key by contacting AccuWeather. **
    -->

<head>
    <script src="http://code.jquery.com/jquery-1.9.1.js"></script>

    <script type="text/javascript">

        // Configure our weather widget during jQuery.OnReady
        $(function () {

            var language = "en";
            var isMetric = false;
            var apiKey = "{contact accuweather to get your own key}";

            // Searches for a city with the name specified in freeText.
            // freeText can be something like:
            //          new york
            //          new york, ny
            //          paris
            //          paris, france
            var awxCityLookUp = function (freeText) {
                var url = "http://apidev.accuweather.com/locations/v1/search?q=" + freeText + "&apikey=" + apiKey;
                $.ajax({
                    type: "GET",
                    url: url,
                    dataType: "jsonp",
                    success: function (data) { awxCityLookUpFound(data); }
                });
            };

            // Update the weather info
            var awxCityLookUpFound = function (data) {
                var msg;
                if (data.length == 1) {
                    msg = "One location found: <b>" + data[0].LocalizedName + "</b>. (key = " + data[0].Key + ")";
                    $("#awxWidgetInfo").html(msg);
                    awxGetCurrentConditions($, data[0].Key);
                }
                else if(data.length == 0) {
                    msg = "No locations found";
                    $("#awxWidgetInfo").html(msg);
                    $("#awxWidgetWeather").html("...");
                }
                else {
                    msg = "Multiple locations found. Selecting the first one: " + 
                        "<b>" + data[0].LocalizedName + ", " + data[0].Country.ID + "</b>. (key = " + data[0].Key + ")";
                    $("#awxWidgetInfo").html(msg);
                    awxGetCurrentConditions($, data[0].Key);
                }
            };

            // Get the current conditions and update the widget
            var awxGetCurrentConditions = function ($, locationKey) {
                var url = "http://apidev.accuweather.com/currentconditions/v1/" + locationKey + ".json?language=" + language + "&apikey=" + apiKey
                $.ajax({
                    type: "GET",
                    url: url,
                    dataType: "jsonp",
                    success: function (data) {
                            var html;
                            if(data && data.length > 0) {
                                var conditions = data[0];
                                var temp = isMetric ? conditions.Temperature.Metric : conditions.Temperature.Imperial;
                                html = "Current conditions: <b>" + conditions.WeatherText + ", " + temp.Value + " " + temp.Unit + "</b>";
                            }
                            else {
                                html = "Current conditions: N/A";
                            }
                        $("#awxWidgetWeather").html(html);
                    }
                });
            };

            $("#awxSearchTextBox").keypress(function (e) {
                if ((e.which && e.which == 13) || (e.keyCode && e.keyCode == 13)) {
                    var text = $("#awxSearchTextBox").val();
                    awxCityLookUp(text);
                    return false;
                } else {
                    return true;
                }
            });

            $("#awxSearchButton").click(function () {
                var text = $("#awxSearchTextBox").val();
                awxCityLookUp(text);
            });

        });

    </script>
</head>

<body>
    <h2>Location Search and Current Conditions</h2>
    <p>This page shows how to search for a location by name (e.g. new york, ny) or by postal code (e.g. 64110) and fetch the current conditions and the location.</p>

    <div>Enter location name:
        <input id="awxSearchTextBox" placeholder="new york, ny" />
        <input id="awxSearchButton" type="submit" value="Search" />
    </div>

    <p></p>
    <div id="awxWidgetInfo">(info messages will be displayed here)</div>
    <div id="awxWidgetWeather">(the weather will be displayed here)</div>

    <p>View source of this page to get an idea of how this works.</p>
    <p>Visit <a href="http://api.accuweather.com/developers/">http://api.accuweather.com/developers/</a> for more information.</p>
</body>

</html>

